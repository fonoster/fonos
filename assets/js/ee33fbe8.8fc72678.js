"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1212],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=a,h=c["".concat(s,".").concat(m)]||c[m]||d[m]||i;return n?o.createElement(h,r(r({ref:t},u),{},{components:n})):o.createElement(h,r({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7346:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var o=n(7462),a=(n(7294),n(3905));const i={slug:"The essentials of building Voice Applications with Fonoster",title:"The essentials of building Voice Applications with Fonoster",authors:["psanders"],tags:["fonoster","voice"]},r=void 0,l={permalink:"/blog/The essentials of building Voice Applications with Fonoster",editUrl:"https://github.com/fonoster/website/edit/main/docs/blog/blog/2022-10-03-voice_app_create.md",source:"@site/blog/2022-10-03-voice_app_create.md",title:"The essentials of building Voice Applications with Fonoster",description:"The purpose of this tutorial is to show the basics of Fonoster. Here you will find how to create a Voice Application, add a Number, and then use that Number to originate a call. Please follow the guide in sequence, as each step builds on the last one.",date:"2022-10-03T00:00:00.000Z",formattedDate:"October 3, 2022",tags:[{label:"fonoster",permalink:"/blog/tags/fonoster"},{label:"voice",permalink:"/blog/tags/voice"}],readingTime:6.39,hasTruncateMarker:!1,authors:[{name:"Pedro Sanders",title:"CTO at Fonoster",url:"https://github.com/psanders",imageURL:"https://github.com/psanders.png",key:"psanders"}],frontMatter:{slug:"The essentials of building Voice Applications with Fonoster",title:"The essentials of building Voice Applications with Fonoster",authors:["psanders"],tags:["fonoster","voice"]},prevItem:{title:"Deploying Fonoster with Cloud-Init",permalink:"/blog/Deploying Fonoster with Cloud-Init"},nextItem:{title:"Welcome",permalink:"/blog/welcome"}},s={authorsImageUrls:[void 0]},p=[{value:"Using Ngrok to publish your Voice Application",id:"using-ngrok-to-publish-your-voice-application",level:2},{value:"Building a SIP Network",id:"building-a-sip-network",level:2},{value:"Adding a SIP Service Provider",id:"adding-a-sip-service-provider",level:2},{value:"Adding a SIP Number",id:"adding-a-sip-number",level:2},{value:"Creating a SIP Domain",id:"creating-a-sip-domain",level:2},{value:"Using the API to make a call",id:"using-the-api-to-make-a-call",level:2},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Giving feedback to Team Fonoster",id:"giving-feedback-to-team-fonoster",level:4}],u={toc:p},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"The purpose of this tutorial is to show the basics of Fonoster. Here you will find how to create a Voice Application, add a Number, and then use that Number to originate a call. Please follow the guide in sequence, as each step builds on the last one."),(0,a.kt)("h1",{id:"requirements"},"Requirements"),(0,a.kt)("p",null,"Before you start this guide, you will need the following:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A set of credentials from ",(0,a.kt)("a",{parentName:"li",href:"https://form.typeform.com/to/sDv75mFr"},"here")," \ud83d\udc48"),(0,a.kt)("li",{parentName:"ul"},"An account for access to a SIP Service Provider (For US and Canada, we recommend ",(0,a.kt)("a",{parentName:"li",href:"https://voip.ms/residential"},"voip.ms"),")"),(0,a.kt)("li",{parentName:"ul"},"NodeJS 14+ (Use nvm if possible)"),(0,a.kt)("li",{parentName:"ul"},"Fonoster command-line tool install with ",(0,a.kt)("inlineCode",{parentName:"li"},"npm install -g @fonoster/ctl")),(0,a.kt)("li",{parentName:"ul"},"Ngrok ",(0,a.kt)("inlineCode",{parentName:"li"},"install with npm install -g ngrok"))),(0,a.kt)("p",null,"You can login to the server with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"fonoster auth:login\n")),(0,a.kt)("p",null,"And your output will be similar to:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"Access your Fonoster infrastructure\nPress ^C at any time to quit.\n? api endpoint api.fonoster.io\n? access key id psanders\n? access key token *************************...\n? ready? Yes\nAccessing endpoint api.fonoster.io... Done\n")),(0,a.kt)("p",null,"Then, set the default Project: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"# Get the PROJECT_ID of the project using the 'projects:list' command \nfonoster projects:use ${PROJECT_ID}\n")),(0,a.kt)("h1",{id:"creating-a-basic-voice-application"},"Creating a basic Voice Application"),(0,a.kt)("p",null,"A Voice Application is a server that takes control of the flow of a call. "),(0,a.kt)("p",null,"A Voice Application can use any combination of the following verbs:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Answer")," - Accepts the call"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Hangup")," - Closes the call"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Play")," - It takes an URL or file and streams the sound back to the calling part"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Say")," - It takes a text, synthesizes the text into audio, and streams the result"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Gather")," - It waits for DTMF events and returns back the result"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"SGather")," - It listen for a stream DTMF events and returns back the result"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Record")," - It records the voice of the calling party and saves the audio on the Storage sub-system"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Mute")," - It tells the channel to stop sending media, thus effectively muting the channel"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Unmute")," - It tells the channel to allow media flow")),(0,a.kt)("p",null,"To create a Voice Application perform the following steps."),(0,a.kt)("p",null,"First, clone the NodeJS example template as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"git clone https://github.com/fonoster/nodejs-voiceapp\n")),(0,a.kt)("p",null,"Next, install the dependencies:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"cd nodejs-voiceapp\nnpm install\n")),(0,a.kt)("p",null,"Finally, launch the Voice Application with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"npm start\n")),(0,a.kt)("p",null,"Your output will look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"info: initializing voice server\ninfo: starting voice server on @ 0.0.0.0, port=3000\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Your app will live at ",(0,a.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:3000.")," Be sure to leave the server up!")),(0,a.kt)("h2",{id:"using-ngrok-to-publish-your-voice-application"},"Using Ngrok to publish your Voice Application"),(0,a.kt)("p",null,"Now that we have our Voice Application up and running, we need to make it available on the Internet\u2014\u2014the fastest way to enable public access by using Ngrok. "),(0,a.kt)("p",null,"For example, with ngrok, you can publish a web server with a single command."),(0,a.kt)("p",null,"On a new console, run Ngrok with the following command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"ngrok http 3000\n")),(0,a.kt)("p",null,"The output will look like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/80093500/193677206-08190c5d-b1b1-4358-bd32-4b7d62dd99ef.png",alt:"ngrok_output"})),(0,a.kt)("p",null,"Leave this service running, and save the Forwarding URL for use in the next step."),(0,a.kt)("h2",{id:"building-a-sip-network"},"Building a SIP Network"),(0,a.kt)("p",null,"A SIP Network has all the building blocks needed to establish communication between two SIP endpoints (i.e., softphone, webphone, cellphone, the PSTN, etc.) We want to configure a Number and route the calls to our Voice Application on this guide."),(0,a.kt)("p",null,"Let's start by creating a SIP Service Provider."),(0,a.kt)("h2",{id:"adding-a-sip-service-provider"},"Adding a SIP Service Provider"),(0,a.kt)("p",null,"A SIP Service Provider is an organization that will terminate your calls to the phone network (or PSTN). "),(0,a.kt)("p",null,"You will need the ",(0,a.kt)("inlineCode",{parentName:"p"},"username"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"password"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"host")," you obtained from your SIP Service Provider for this section."),(0,a.kt)("p",null,"Create a new provider with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"fonoster providers:create\n")),(0,a.kt)("p",null,"The output will look similar to this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"This utility will help you create a new Provider\nPress ^C at any time to quit.\n? friendly name VOIPMS\n? username 215706\n? secret [hidden]\n? host newyork1.voip.ms\n? transport tcp\n? expire 300\n? ready? Yes\nCreating provider YourServiceProvider... Done\n")),(0,a.kt)("h2",{id:"adding-a-sip-number"},"Adding a SIP Number"),(0,a.kt)("p",null,"A Number, often referred to as DID/DOD, is a number managed by your SIP Service provider."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If your Provider doesn't accept E164, you can append the ",(0,a.kt)("inlineCode",{parentName:"p"},"--ignore-e164-validation")),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-none"},"fonoster numbers:create --ignore-e164-validation\n"))),(0,a.kt)("p",null,"Here is an example of the output:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"This utility will help you create a new Number\nPress ^C at any time to quit.\n? number in E.164 format (e.g. +16471234567) 9842753574    \n? service provider VOIPMS\n? aor link (leave empty)\n? webhook https://5a2d2ea5d84d.ngrok.io # Replace with the value you obtained from Ngrok\n? ready? Yes\nCreating number +17853178071... KyjgGEkasj\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"}," Be sure to replace the information with what was given to you by your Provider.")),(0,a.kt)("h2",{id:"creating-a-sip-domain"},"Creating a SIP Domain"),(0,a.kt)("p",null,"A SIP Domain is a space within the SIP Network where SIP entities live (usually SIP Agents). To create a SIP Domain, you can use the command-line tool or the SDK."),(0,a.kt)("p",null,"In this step, you need to select the Number you just created as your ",(0,a.kt)("inlineCode",{parentName:"p"},"Egreess Number"),'. Also, make sure to use an "unclaimed" ',(0,a.kt)("inlineCode",{parentName:"p"},"uri"),' or you will receive this error: "\u203a Error: This Domain already exists."'),(0,a.kt)("p",null,"Create a new Domain with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"fonoster domains:create\n")),(0,a.kt)("p",null,"Your output will look similar to this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"This utility will help you create a new Domain\nPress ^C at any time to quit.\n? friendly name Acme Corp\n? domain uri (e.g acme.com) sip.acme.com\n? egress number none\n? egress rule .*\n? ready? Yes\nCreating domain Acme Corp... Jny9B_qaIh\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"In the demo server, you don't need to own the Domain. Any available URI is fair game!")),(0,a.kt)("h2",{id:"using-the-api-to-make-a-call"},"Using the API to make a call"),(0,a.kt)("p",null,"To make a call, you need install the SDK."),(0,a.kt)("p",null,"Install the SDK, from within the ",(0,a.kt)("inlineCode",{parentName:"p"},"voiceapp"),", with:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},"npm install --save @fonoster/sdk \n")),(0,a.kt)("p",null,"Next, create the script ",(0,a.kt)("inlineCode",{parentName:"p"},"call.js")," with the following code:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-none"},'// This will load the SDK and reuse your Fonoster credentials\nconst Fonoster = require("@fonoster/sdk");\nconst callManager = new Fonoster.CallManager();\n\n// Few notes:\n//  1. Update the from to look exactly as the Number you added \n//  2. Use an active phone or mobile\n//  3. Replace the webhook with the one from your Ngrok\ncallManager.call({\n from: "9842753574",\n to: "17853178070",\n webhook: "https://5a2d2ea5d84d.ngrok.io",\n ignoreE164Validation: true\n})\n.then(console.log)\n.catch(console.error);\n')),(0,a.kt)("p",null,"Finally, run your script with: ",(0,a.kt)("inlineCode",{parentName:"p"},"node call.js")),(0,a.kt)("p",null,'If everything goes well, you will start seeing the output in the console you are running your Voice Application. You will also receive a call that will stream a "Hello World," which further confirms that everything is behaving as it should.'),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/80093500/193678241-8be38da0-cb54-4b25-a4d3-7842a94baa00.png",alt:"call_request"})),(0,a.kt)("h3",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Are you not receiving the call at all?\nThe first thing to check is that your SIP Service Provider configuration is correct. Next, double-check the ",(0,a.kt)("inlineCode",{parentName:"li"},"username"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"password"),", and ",(0,a.kt)("inlineCode",{parentName:"li"},"host"),". If your Provider has an Admin console, check if you can see the registration from Fonoster.")),(0,a.kt)("p",null,"Next, make sure the ",(0,a.kt)("inlineCode",{parentName:"p"},"from")," matches the Number given to you by your Provider.\nAlso, double-check the ",(0,a.kt)("inlineCode",{parentName:"p"},"to")," has the correct prefix (for example, +1, etc.)."),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"You receive the call but immediately hang up (did not hear a sound)\nFirst, verify that Ngrok is still running. Next, compare Ngrok's URL with the webhook on your Number. They both need to match!")),(0,a.kt)("p",null,"Then observe the console's output where your Voice Application is running, and see if there are any errors."),(0,a.kt)("h4",{id:"giving-feedback-to-team-fonoster"},"Giving feedback to Team Fonoster"),(0,a.kt)("p",null,"We want to provide you with the best possible experience. To do that, we need your valuable feedback. Because we know you are busy, we provide two ways to get quick feedback from you. From the command line, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"fonoster bug")," command to start a GitHub issue. Or, you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"fonoster feedback")," command to complete a short survey (which takes less than 30 seconds)."))}d.isMDXComponent=!0}}]);